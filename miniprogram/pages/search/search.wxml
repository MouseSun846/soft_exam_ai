<!-- search.wxml -->

<!-- é¡µé¢å¤´ -->
<view class="page-header">
  <text class="page-header-title">æœç´¢</text>
</view>
<view class="page-header-placeholder"></view>

<view class="container">

  <!-- æœç´¢æ¡†åŒºåŸŸ -->
  <view class="search-header">
    <view class="search-box-wrapper">
      <button class="back-btn" bindtap="onBack">â†</button>
      <view class="search-box">
        <text class="search-prefix-icon">ğŸ”</text>
        <input 
          class="search-input" 
          placeholder="æœç´¢æ–‡æ¡£åç§°æˆ–å†…å®¹å…³é”®è¯..."
          bindinput="onSearchInput"
          bindconfirm="onSearchConfirm"
          value="{{searchKeyword}}"
          focus="{{true}}"
        />
        <text class="search-clear-icon" bindtap="onClearInput" wx:if="{{searchKeyword}}">Ã—</text>
      </view>
    </view>
  </view>

  <!-- é»˜è®¤ç©ºçŠ¶æ€ -->
  <view class="default-empty-state" wx:if="{{!searchResults.length && !searchKeyword}}">
    <image class="empty-icon" src="/images/search-default.png" mode="aspectFit"></image>
    <text class="empty-text">æœç´¢ä½ æƒ³è¦çš„å†…å®¹</text>
    <text class="empty-subtext">è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢</text>
  </view>

  <!-- æœç´¢å†å²è®°å½• -->
  <view class="history-section" wx:if="{{!searchResults.length && searchKeyword && searchHistory.length > 0}}">
    <view class="section-header">
      <text class="section-title">æœç´¢å†å²</text>
      <text class="clear-history" bindtap="clearHistory">æ¸…é™¤å†å²</text>
    </view>
    <view class="history-list">
      <block wx:for="{{searchHistory}}" wx:key="index">
        <view class="history-item" bindtap="onHistoryTagTap" data-keyword="{{item}}">
          <view class="history-item-content">
            <text class="history-item-icon">ğŸ”</text>
            <text class="history-item-text">{{item}}</text>
          </view>
          <text class="history-item-delete" bindtap="removeHistoryItem" data-keyword="{{item}}">Ã—</text>
        </view>
      </block>
    </view>
  </view>

  <!-- æœç´¢ç»“æœ -->
  <view class="results-section" wx:if="{{searchResults.length > 0}}">
    <view class="section-header">
      <text class="section-title">æœç´¢ç»“æœ</text>
      <text class="result-count">{{searchResults.length}} ä¸ªç»“æœ</text>
    </view>

    <!-- ç€‘å¸ƒæµæ˜¾ç¤º -->
    <view class="waterfall-layout">
      <view class="waterfall-column" id="column1">
        <block wx:for="{{leftColumnItems}}" wx:key="id">
          <view class="knowledge-item" bindtap="viewKnowledgeDetail" data-id="{{item.id}}">
            <view class="knowledge-thumb">
              <image class="thumb-img" src="{{item.thumbnail || '/images/default-knowledge.png'}}" mode="aspectFill"></image>
            </view>
            <view class="knowledge-info">
              <text class="knowledge-name">{{item.name}}</text>
              <view class="knowledge-meta">
                <text class="document-count">{{item.documentCount}} ä¸ªæ–‡æ¡£</text>
                <text class="knowledge-time">{{item.updatedAt}}</text>
              </view>
              <view class="knowledge-description">{{item.description}}</view>
            </view>
          </view>
        </block>
      </view>
      <view class="waterfall-column" id="column2">
        <block wx:for="{{rightColumnItems}}" wx:key="id">
          <view class="knowledge-item" bindtap="viewKnowledgeDetail" data-id="{{item.id}}">
            <view class="knowledge-thumb">
              <image class="thumb-img" src="{{item.thumbnail || '/images/default-knowledge.png'}}" mode="aspectFill"></image>
            </view>
            <view class="knowledge-info">
              <text class="knowledge-name">{{item.name}}</text>
              <view class="knowledge-meta">
                <text class="document-count">{{item.documentCount}} ä¸ªæ–‡æ¡£</text>
                <text class="knowledge-time">{{item.updatedAt}}</text>
              </view>
              <view class="knowledge-description">{{item.description}}</view>
            </view>
          </view>
        </block>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty-state" wx:if="{{!searchResults.length && searchKeyword && !isLoading}}">
    <image class="empty-icon" src="/images/search-empty.png" mode="aspectFit"></image>
    <text class="empty-text">æ²¡æœ‰æ‰¾åˆ°ç›¸å…³å†…å®¹</text>
    <text class="empty-subtext">è¯•è¯•å…¶ä»–å…³é”®è¯å§</text>
  </view>
</view>

<!-- åº•éƒ¨å¯¼èˆªæ  -->
<bottom-tabbar current-tab="{{1}}"></bottom-tabbar>