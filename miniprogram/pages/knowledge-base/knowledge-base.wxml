<!-- knowledge-base.wxml -->

<!-- é¡µé¢å¤´ -->
<view class="page-header">
  <text class="page-header-title">çŸ¥è¯†åº“</text>
</view>
<view class="page-header-placeholder"></view>

<view class="container">
  <!-- æœç´¢å’Œæ“ä½œæ  -->
  <view class="search-section">
    <view class="search-box">
      <text class="search-icon">ğŸ”</text>
      <input 
        class="search-input" 
        placeholder="æœç´¢æ–‡æ¡£åç§°æˆ–å†…å®¹å…³é”®è¯..."
        bindinput="onSearchInput"
        value="{{searchKeyword}}"
        disabled
      />
    </view>
    <!-- æ–°å¢çŸ¥è¯†åº“æŒ‰é’® -->
    <view class="add-knowledge-btn" bindtap="showAddKnowledgeModal">
      <text class="add-icon">â•</text>
    </view>
  </view>

  <!-- çŸ¥è¯†åº“ç»Ÿè®¡ -->
  <view class="stats-section">
    <view class="stat-card">
      <text class="stat-number">{{knowledgeBases.length}}</text>
      <text class="stat-label">çŸ¥è¯†åº“æ•°é‡</text>
    </view>
    <view class="stat-card">
      <text class="stat-number">{{totalDocuments}}</text>
      <text class="stat-label">æ–‡æ¡£æ€»æ•°</text>
    </view>
    <view class="stat-card">
      <text class="stat-number">{{parsedDocuments}}</text>
      <text class="stat-label">å·²è§£æ</text>
    </view>
  </view>

  <!-- çŸ¥è¯†åº“åˆ—è¡¨ -->
  <view class="knowledge-section">
    <view class="section-header">
      <text class="section-title">æˆ‘çš„çŸ¥è¯†åº“</text>
      <text class="document-count">{{filteredKnowledgeBases.length}} ä¸ªçŸ¥è¯†åº“</text>
    </view>

    <view class="knowledge-list">
      <block wx:for="{{filteredKnowledgeBases}}" wx:key="id">
        <view class="knowledge-item" bindtap="viewKnowledgeBase" data-id="{{item.id}}">
          <view class="knowledge-thumb">
            <image class="thumb-img" src="{{item.thumbnail || '/images/default-knowledge.png'}}" mode="aspectFill"></image>
          </view>
          <view class="knowledge-info">
            <text class="knowledge-name">{{item.name}}</text>
            <view class="knowledge-meta">
              <text class="document-count">{{item.documentCount}} ä¸ªæ–‡æ¡£</text>
              <text class="knowledge-time">{{item.updatedAt}}</text>
            </view>
            <view class="knowledge-description">{{item.description}}</view>
          </view>
          <view class="knowledge-actions">
            <button class="action-btn view-btn" bindtap="viewKnowledgeBase" data-id="{{item.id}}">æŸ¥çœ‹</button>
            <button class="action-btn delete-btn" bindtap="deleteKnowledgeBase" data-id="{{item.id}}" catchtap="stopEventPropagation">åˆ é™¤</button>
          </view>
        </view>
      </block>
    </view>
  </view>
</view>

<!-- åº•éƒ¨æ‚¬æµ®èœå• -->
<bottom-tabbar current-tab="{{1}}"></bottom-tabbar>

<!-- æ–°å¢çŸ¥è¯†åº“å¼¹çª— -->
<view class="add-knowledge-modal {{showAddKnowledgeModal ? 'show' : ''}}">
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">æ–°å¢çŸ¥è¯†åº“</text>
      <text class="modal-close" bindtap="closeAddKnowledgeModal">Ã—</text>
    </view>
    <view class="modal-body">
      <input 
        class="input-field" 
        placeholder="è¯·è¾“å…¥çŸ¥è¯†åº“åç§°" 
        bindinput="onNameInput" 
        value="{{newKnowledgeName}}"
      />
      <textarea 
        class="textarea-field" 
        placeholder="è¯·è¾“å…¥çŸ¥è¯†åº“æè¿°" 
        bindinput="onDescriptionInput" 
        value="{{newKnowledgeDescription}}"
      />
    </view>
    <view class="modal-footer">
      <button class="cancel-btn" bindtap="closeAddKnowledgeModal">å–æ¶ˆ</button>
      <button class="confirm-btn" bindtap="addKnowledgeBase">ç¡®å®š</button>
    </view>
  </view>
</view>